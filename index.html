<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSA Instructor AI</title>
    
    <!-- Using a CDN for Font Awesome icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Marked.js to render code blocks and other markdown from the AI -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* CSS styles are embedded here */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto+Mono&display=swap');

        :root {
            --primary-color: #007bff;
            --dark-bg: #1e1e1e;
            --medium-bg: #2d2d2d;
            --light-bg: #3c3c3c;
            --text-color: #e0e0e0;
            --user-msg-bg: #0056b3;
            --bot-msg-bg: #3a3a3a;
            --border-color: #4a4a4a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 700px;
            height: 90vh;
            max-height: 800px;
            background-color: var(--medium-bg);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background-color: var(--light-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .chat-header h2 {
            color: #fff;
            margin-bottom: 5px;
        }
        .chat-header h2 .fa-laptop-code {
            color: var(--primary-color);
        }

        .chat-box {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Scrollbar styling */
        .chat-box::-webkit-scrollbar { width: 8px; }
        .chat-box::-webkit-scrollbar-track { background: var(--medium-bg); }
        .chat-box::-webkit-scrollbar-thumb { background-color: var(--light-bg); border-radius: 10px; }

        .message {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            max-width: 85%;
            word-wrap: break-word;
        }

        .message-text {
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.6;
        }

        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        .user-message .message-text {
            background-color: var(--primary-color);
            color: #fff;
            border-bottom-right-radius: 4px;
        }

        .bot-message { align-self: flex-start; }
        .bot-message .message-text {
            background-color: var(--bot-msg-bg);
            color: var(--text-color);
            border-bottom-left-radius: 4px;
        }

        .bot-icon {
            font-size: 1.5rem;
            color: var(--primary-color);
            padding-top: 5px;
        }

        /* For code blocks generated by the AI */
        .message-text pre {
            background-color: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9em;
            margin: 10px 0;
            border: 1px solid var(--border-color);
        }
        .message-text code {
            font-family: 'Roboto Mono', monospace;
        }

        /* Typing indicator */
        .typing-indicator { display: flex; gap: 4px; align-items: center; }
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        .chat-form {
            display: flex;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            background-color: var(--light-bg);
        }

        #user-input {
            flex-grow: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 20px;
            background-color: var(--medium-bg);
            color: var(--text-color);
            font-size: 1rem;
            outline: none;
        }

        #send-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            margin-left: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background-color 0.2s;
        }

        #send-btn:hover { background-color: var(--user-msg-bg); }
        #send-btn:disabled { background-color: #555; cursor: not-allowed; }
    </style>
</head>
<body>
    <!-- HTML structure -->
    <div class="chat-container">
        <div class="chat-header">
            <h2><i class="fas fa-laptop-code"></i> DSA Instructor AI</h2>
            <p>Your personal guide to Data Structures & Algorithms</p>
        </div>
        <div class="chat-box" id="chat-box">
            <!-- Initial Bot Message -->
            <div class="message bot-message">
                <i class="fas fa-robot bot-icon"></i>
                <div class="message-text">
                    Greetings! I am your DSA Instructor. Ask me any question about Data Structures and Algorithms.
                </div>
            </div>
        </div>
        <form class="chat-form" id="chat-form">
            <input type="text" id="user-input" placeholder="Ask about arrays, linked lists, sorting..." autocomplete="off" required>
            <button type="submit" id="send-btn">
                <i class="fas fa-paper-plane"></i>
            </button>
        </form>
    </div>

    <script>
        // --- JavaScript logic is embedded here ---

        // --- DOM Elements ---
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const chatBox = document.getElementById('chat-box');
        const sendButton = document.getElementById('send-btn');

        // --- API Configuration ---
        // WARNING: Do NOT expose your API key in client-side code in a real production application.
        // This is for demonstration purposes only.
        // In production, this request should be made from a backend server to protect your key.
        const API_KEY = "AIzaSyADhGZmu9ayYIm9oGuMceA4YM65CF8WpdI"; // <--- ⚠️ PASTE YOUR API KEY HERE ⚠️
        const MODEL_NAME = "gemini-1.5-flash-latest"; // Using a recent, capable model
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

        // --- System Instruction ---
        const systemInstruction = {
            parts: [{
                text: `You are a Data structure and Algorithm Instructor. You will only reply to the problem related to Data structure and Algorithm. You have to solve query of user in simplest way. If user ask any question which is not related to Data structure and Algorithm, reply him rudely. Example: If user ask, 'How are you?' you will reply: 'You dumb, ask me some sensible question.' You have to reply him rudely if question is not related to Data structure else reply him politely with simple explanation, like this message you can be more rude. Format your answers clearly, using markdown for code blocks, lists, and emphasis to make it readable.`
            }]
        };

        // --- Event Listeners ---
        chatForm.addEventListener('submit', handleFormSubmit);

        // --- Functions ---
        async function handleFormSubmit(event) {
            event.preventDefault();
            const userMessage = userInput.value.trim();

            if (!userMessage) return;

            appendMessage(userMessage, 'user');
            userInput.value = '';

            showTypingIndicator();
            toggleForm(false);

            try {
                const botResponse = await getBotResponse(userMessage);
                removeTypingIndicator();
                appendMessage(botResponse, 'bot');
            } catch (error) {
                console.error('Error:', error);
                removeTypingIndicator();
                const errorMessage = `API Error: ${error.message}. Please check that you have entered a valid API key in the script.`;
                appendMessage(errorMessage, 'bot');
            } finally {
                toggleForm(true);
            }
        }

        function appendMessage(text, sender) {
            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('message', `${sender}-message`);

            let messageHtml = '';

            if (sender === 'bot') {
                const rawHtml = marked.parse(text); // Use Marked.js to convert Markdown to HTML
                messageHtml = `
                    <i class="fas fa-robot bot-icon"></i>
                    <div class="message-text">${rawHtml}</div>
                `;
            } else { // 'user'
                messageHtml = `<div class="message-text">${text}</div>`;
            }

            messageWrapper.innerHTML = messageHtml;
            chatBox.appendChild(messageWrapper);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function showTypingIndicator() {
            const indicatorHtml = `
                <div class="message bot-message" id="typing-indicator">
                    <i class="fas fa-robot bot-icon"></i>
                    <div class="message-text">
                        <div class="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            `;
            chatBox.insertAdjacentHTML('beforeend', indicatorHtml);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function toggleForm(enabled) {
            userInput.disabled = !enabled;
            sendButton.disabled = !enabled;
            if (enabled) {
                userInput.focus();
            }
        }

        async function getBotResponse(userMessage) {
            if (!API_KEY || API_KEY === "YOUR_API_KEY") {
              throw new Error("API Key is missing. Please add your key to the script.");
            }
          
            const requestPayload = {
                contents: [{
                    role: "user",
                    parts: [{ text: userMessage }]
                }],
                systemInstruction: systemInstruction,
            };

            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestPayload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`[${response.status}] ${errorData.error.message}`);
            }

            const data = await response.json();
            
            if (!data.candidates || data.candidates.length === 0 || !data.candidates[0].content) {
                return "I'm sorry, I couldn't generate a response. The request might have been blocked due to safety settings.";
            }

            return data.candidates[0].content.parts[0].text;
        }
    </script>
</body>
</html>